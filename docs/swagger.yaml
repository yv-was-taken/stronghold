basePath: /
definitions:
  handlers.CreateAccountRequest:
    properties:
      wallet_address:
        type: string
    type: object
  handlers.CreateAccountResponse:
    properties:
      account_number:
        type: string
      expires_at:
        type: string
      recovery_file:
        type: string
      wallet_address:
        type: string
    type: object
  handlers.HealthResponse:
    properties:
      services:
        additionalProperties:
          type: string
        type: object
      status:
        type: string
      timestamp:
        type: integer
      version:
        type: string
    type: object
  handlers.InitiateDepositRequest:
    properties:
      amount_usdc:
        type: number
      provider:
        type: string
    type: object
  handlers.InitiateDepositResponse:
    properties:
      amount_usdc:
        type: number
      checkout_url:
        type: string
      client_secret:
        type: string
      deposit_id:
        type: string
      instructions:
        type: string
      provider:
        type: string
      publishable_key:
        type: string
      status:
        type: string
      wallet_address:
        type: string
    type: object
  handlers.LinkWalletRequest:
    properties:
      wallet_address:
        type: string
    type: object
  handlers.LoginRequest:
    properties:
      account_number:
        type: string
    type: object
  handlers.LoginResponse:
    properties:
      account_number:
        type: string
      expires_at:
        type: string
      private_key:
        description: Only returned over TLS when KMS-encrypted key exists
        type: string
      wallet_address:
        type: string
    type: object
  handlers.PricingResponse:
    properties:
      currency:
        type: string
      network:
        type: string
      routes:
        items:
          $ref: '#/definitions/handlers.RoutePrice'
        type: array
    type: object
  handlers.RefreshTokenResponse:
    properties:
      expires_at:
        type: string
    type: object
  handlers.RoutePrice:
    properties:
      description:
        type: string
      method:
        type: string
      path:
        type: string
      price_usd:
        type: number
    type: object
  handlers.ScanContentRequest:
    properties:
      content_type:
        description: '"html", "markdown", "json", "text", "code"'
        type: string
      file_path:
        description: For file reads, e.g., "README.md"
        type: string
      source_type:
        description: '"web_page", "file", "api_response", "code_repo"'
        type: string
      source_url:
        description: Where content came from (e.g., https://github.com/...)
        type: string
      text:
        type: string
    type: object
  handlers.ScanOutputRequest:
    properties:
      text:
        type: string
    type: object
  stronghold.Decision:
    enum:
    - ALLOW
    - WARN
    - BLOCK
    type: string
    x-enum-varnames:
    - DecisionAllow
    - DecisionWarn
    - DecisionBlock
  stronghold.ScanResult:
    properties:
      decision:
        $ref: '#/definitions/stronghold.Decision'
      latency_ms:
        type: integer
      metadata:
        additionalProperties: true
        type: object
      reason:
        type: string
      recommended_action:
        description: What the agent should do
        type: string
      request_id:
        type: string
      sanitized_text:
        description: Clean version with threats removed
        type: string
      scores:
        additionalProperties:
          format: float64
          type: number
        type: object
      threats_found:
        description: Detailed threat info
        items:
          $ref: '#/definitions/stronghold.Threat'
        type: array
    type: object
  stronghold.Threat:
    properties:
      category:
        description: 'Broad category: "prompt_injection", "credential_leak"'
        type: string
      description:
        description: Human-readable explanation
        type: string
      location:
        description: Where in text (line/offset if available)
        type: string
      pattern:
        description: What matched (the specific pattern)
        type: string
      severity:
        description: '"high", "medium", "low"'
        type: string
    type: object
host: localhost:8080
info:
  contact:
    name: Stronghold Support
    url: https://github.com/yv-was-taken/stronghold
  description: |-
    Pay-per-request AI security scanning API with 4-layer threat detection.

    ## Authentication
    Most endpoints require JWT authentication via httpOnly cookies.
    Create an account at POST /v1/auth/account to get started.

    ## Payments
    Scan endpoints require x402 payment via the X-PAYMENT header.
    See GET /v1/pricing for current endpoint prices.
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  title: Stronghold API
  version: "1.0"
paths:
  /docs:
    get:
      description: Interactive API documentation using Swagger UI
      produces:
      - text/html
      responses: {}
      summary: API Documentation
      tags:
      - docs
  /docs/swagger.json:
    get:
      description: Returns the OpenAPI 3.0 specification in JSON format
      produces:
      - application/json
      responses: {}
      summary: OpenAPI Specification
      tags:
      - docs
  /health:
    get:
      description: Returns the health status of the API and its dependencies
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/handlers.HealthResponse'
      summary: Health check
      tags:
      - health
  /health/live:
    get:
      description: Kubernetes liveness probe endpoint
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Liveness probe
      tags:
      - health
  /health/ready:
    get:
      description: Kubernetes readiness probe endpoint
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
        "503":
          description: Service Unavailable
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Readiness probe
      tags:
      - health
  /v1/account:
    get:
      description: Returns the authenticated user's account details including balance
        and deposit stats
      produces:
      - application/json
      responses:
        "200":
          description: Account details
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Not authenticated
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Account not found
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - CookieAuth: []
      summary: Get account details
      tags:
      - account
  /v1/account/deposit:
    post:
      consumes:
      - application/json
      description: Start a deposit via Stripe (requires linked wallet) or direct crypto
        transfer
      parameters:
      - description: Deposit details
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handlers.InitiateDepositRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/handlers.InitiateDepositResponse'
        "400":
          description: Invalid request or no wallet linked
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Not authenticated
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - CookieAuth: []
      summary: Initiate a deposit
      tags:
      - account
  /v1/account/deposits:
    get:
      description: Returns paginated deposit history for the authenticated account
      parameters:
      - description: Number of records to return (default 50)
        in: query
        name: limit
        type: integer
      - description: Number of records to skip (default 0)
        in: query
        name: offset
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Deposits with pagination
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Not authenticated
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - CookieAuth: []
      summary: Get deposit history
      tags:
      - account
  /v1/account/usage:
    get:
      description: Returns paginated usage logs for the authenticated account
      parameters:
      - description: Number of records to return (default 50)
        in: query
        name: limit
        type: integer
      - description: Number of records to skip (default 0)
        in: query
        name: offset
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Usage logs with pagination
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Not authenticated
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - CookieAuth: []
      summary: Get usage logs
      tags:
      - account
  /v1/account/usage/stats:
    get:
      description: Returns aggregated usage statistics including daily breakdown and
        endpoint stats
      parameters:
      - description: Number of days to include (default 30, max 365)
        in: query
        name: days
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Usage statistics
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Not authenticated
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - CookieAuth: []
      summary: Get usage statistics
      tags:
      - account
  /v1/account/wallet:
    put:
      consumes:
      - application/json
      description: Links an Ethereum wallet address to the account for receiving crypto
      parameters:
      - description: Wallet address (0x...)
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handlers.LinkWalletRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Wallet linked successfully
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Invalid wallet address or already linked
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Not authenticated
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - CookieAuth: []
      summary: Link a wallet address
      tags:
      - account
  /v1/auth/account:
    post:
      consumes:
      - application/json
      description: Creates a new account with a generated account number and server-side
        wallet.
      parameters:
      - description: Optional wallet address (ignored if KMS is configured)
        in: body
        name: request
        schema:
          $ref: '#/definitions/handlers.CreateAccountRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/handlers.CreateAccountResponse'
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Server error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Create a new account
      tags:
      - auth
  /v1/auth/login:
    post:
      consumes:
      - application/json
      description: Authenticates using account number and sets httpOnly auth cookies.
        Returns decrypted wallet key if KMS-encrypted key exists.
      parameters:
      - description: Account number
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handlers.LoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/handlers.LoginResponse'
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Invalid credentials
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Account not active
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Login to an account
      tags:
      - auth
  /v1/auth/logout:
    post:
      description: Logs out from all sessions and clears auth cookies
      produces:
      - application/json
      responses:
        "200":
          description: Logged out successfully
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Not authenticated
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - CookieAuth: []
      summary: Logout
      tags:
      - auth
  /v1/auth/me:
    get:
      description: Returns the authenticated user's account information
      produces:
      - application/json
      responses:
        "200":
          description: Account info with id, account_number, wallet_address, balance_usdc,
            status
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Not authenticated
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - CookieAuth: []
      summary: Get current user
      tags:
      - auth
  /v1/auth/refresh:
    post:
      description: Uses the refresh token cookie to get a new access token
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/handlers.RefreshTokenResponse'
        "401":
          description: Invalid or expired refresh token
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Account not active
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Refresh access token
      tags:
      - auth
  /v1/pricing:
    get:
      description: Returns the pricing for all protected endpoints
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/handlers.PricingResponse'
      summary: Get pricing information
      tags:
      - pricing
  /v1/scan/content:
    post:
      consumes:
      - application/json
      description: Scans content from external sources (websites, files, APIs) for
        prompt injection attacks before passing to LLM
      parameters:
      - description: Content scan request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handlers.ScanContentRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/stronghold.ScanResult'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "402":
          description: Payment Required
          schema:
            additionalProperties: true
            type: object
      summary: Scan external content for prompt injection
      tags:
      - scan
  /v1/scan/output:
    post:
      consumes:
      - application/json
      description: Scans LLM output text for credential leaks and sensitive data exposure
      parameters:
      - description: Output scan request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handlers.ScanOutputRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/stronghold.ScanResult'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "402":
          description: Payment Required
          schema:
            additionalProperties: true
            type: object
      summary: Scan LLM output for credential leaks
      tags:
      - scan
schemes:
- http
- https
securityDefinitions:
  CookieAuth:
    in: cookie
    name: stronghold_access
    type: apiKey
swagger: "2.0"
tags:
- description: Health check endpoints for monitoring
  name: health
- description: Endpoint pricing information
  name: pricing
- description: Account creation and authentication
  name: auth
- description: Account management and billing
  name: account
- description: AI security scanning endpoints (payment required)
  name: scan
