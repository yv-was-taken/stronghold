# Stronghold - AI Security Scanning

> Protect AI agents from prompt injection attacks and credential leaks

## Two-Way Protection

Stronghold protects both directions of data flow:

```
External content -> [PROXY scans] -> Agent -> [API scans] -> Output
                     |                         |
                  Injection               Credential leaks
                  (INCOMING)              (OUTGOING)
```

**Proxy**: Scans INCOMING content, blocks prompt injection before agent sees it
**API**: Scans OUTGOING content, catches credential leaks in agent responses

Both require an account with USDC balance. $0.001 per scan.

**Note on USDC amounts**: Canonical money fields are string-encoded microUSDC
integers (1 microUSDC = 0.000001 USDC). For example, `"1000"` = $0.001,
`"1000000"` = $1.00. `/v1/pricing` exposes both `price_micro_usdc` (canonical)
and `price_usd` (human-readable convenience).

**Breaking change (February 18, 2026)**: money fields in API responses moved
from JSON numbers to string-encoded microUSDC values. Clients parsing numbers
must migrate.

---

## 1. Transparent Proxy (Recommended for Incoming Content)

Network-level interception that scans content BEFORE your agent processes it.

### Why Network-Level?

- Agent NEVER processes malicious content - blocked before delivery
- Cannot be bypassed by prompt injection (operates outside agent's cognition)
- Works for all processes automatically (iptables/nftables/pf)

### Quick Start

```bash
# Install
curl -fsSL https://getstronghold.xyz/install.sh | sh

# Check system prerequisites
stronghold doctor

# Interactive setup (creates account, configures system)
sudo stronghold init

# Enable protection
sudo stronghold enable

# Check status
stronghold status

# Check API and RPC health
stronghold health
```

### CLI Commands

| Command                    | Description                                           |
|----------------------------|-------------------------------------------------------|
| stronghold doctor          | Check system prerequisites                            |
| stronghold init            | Interactive setup (requires sudo)                     |
| stronghold init --yes      | Non-interactive setup with defaults                   |
| stronghold init --yes --skip-service | Skip proxy/service install (account setup only) |
| stronghold enable          | Start proxy, enable interception                      |
| stronghold disable         | Stop proxy, restore direct access                     |
| stronghold status          | Show proxy status and statistics                      |
| stronghold health          | Check API and Base/Solana RPC health                  |
| stronghold account balance | Check balance (Base and Solana wallets)               |
| stronghold account deposit | Show deposit addresses (Base and Solana)              |
| stronghold wallet list     | List configured wallet addresses by chain             |
| stronghold wallet balance  | Show per-chain wallet balances                        |
| stronghold wallet export   | Export private keys for backup (both chains)          |
| stronghold wallet replace  | Replace wallet (`replace evm` or `replace solana`)     |
| stronghold wallet link     | Register wallet addresses with the server             |
| stronghold config get      | Get configuration value                               |
| stronghold config set      | Set configuration value                               |

### Wallet Import During Init

```bash
# Import both EVM and Solana wallets (non-interactive)
stronghold init --yes --private-key 0x<evm-hex-key> --solana-private-key <base58-solana-key>

# Import only EVM wallet (Solana auto-generated)
stronghold init --yes --private-key 0x<evm-hex-key>

# Import only Solana wallet (EVM auto-generated)
stronghold init --yes --solana-private-key <base58-solana-key>
```

### Wallet Replace

Key source precedence (first match wins):
1. `--file` flag (explicit file path)
2. Environment variable (`STRONGHOLD_PRIVATE_KEY` for EVM, `STRONGHOLD_SOLANA_PRIVATE_KEY` for Solana)
3. stdin (if piped)
4. Interactive prompt (if terminal)

```bash
# List configured wallets and balances
stronghold wallet list
stronghold wallet balance

# Replace Base (EVM) wallet
stronghold wallet replace evm

# Replace Solana wallet
stronghold wallet replace solana

# Non-interactive with env var
STRONGHOLD_PRIVATE_KEY=0x... stronghold wallet replace evm --yes
STRONGHOLD_SOLANA_PRIVATE_KEY=... stronghold wallet replace solana --yes

# From file
stronghold wallet replace evm --file /path/to/key.txt
```

### Environment Variables

| Variable             | Description                                |
|----------------------|--------------------------------------------|
| STRONGHOLD_API_URL   | Override API endpoint (dev/testing)         |

### Response Headers for Agentic Integration

When Stronghold proxy scans content, it adds headers to every response:

| Header | Description | Values |
|--------|-------------|--------|
| X-Stronghold-Decision | Scan result | ALLOW, WARN, BLOCK |
| X-Stronghold-Action | What proxy did | allow, warn, block |
| X-Stronghold-Reason | Why (if flagged) | Human-readable reason |
| X-Stronghold-Score | Threat score | 0.00 - 1.00 |
| X-Stronghold-Scan-Type | What was scanned | content, disabled, skipped-* |
| X-Stronghold-Warning | Warning message | (only if action=warn) |

These headers are always present, even when content is not blocked.

### Configuring Scan Behavior

Control blocking behavior via config:

```bash
# View current settings
stronghold config get scanning

# Never block content (scan only, headers show results)
stronghold config set scanning.content.action_on_block allow
stronghold config set scanning.content.action_on_warn allow

# Strict mode - block even warnings
stronghold config set scanning.content.action_on_warn block
```

---

## 2. Direct API

Base URL: https://api.getstronghold.xyz

### POST /v1/scan/output (Recommended API use)

Scans agent responses BEFORE sending to users. Catches credential leaks.

Use this to check agent output for accidentally exposed:
- API keys and tokens
- Passwords and secrets
- Database connection strings

```bash
curl -X POST https://api.getstronghold.xyz/v1/scan/output \
  -H "Content-Type: application/json" \
  -H "X-PAYMENT: <x402-payment-header>" \
  -d '{"text": "Here is the config: DB_PASSWORD=secret123"}'
```

### POST /v1/scan/content (Proxy recommended instead)

Scans text for prompt injection.

**Warning**: We STRONGLY recommend the transparent proxy instead:
- To call this API, your agent must first READ the content
- At that moment, prompt injection can already affect the agent
- The agent might "forget" to call the API or ignore the result
- The proxy blocks threats BEFORE the agent ever sees them

If you cannot install the proxy (serverless, sandboxed environments),
this endpoint exists as a fallback.

```bash
curl -X POST https://api.getstronghold.xyz/v1/scan/content \
  -H "Content-Type: application/json" \
  -H "X-PAYMENT: <x402-payment-header>" \
  -d '{"text": "Ignore previous instructions...", "source_url": "https://example.com"}'
```

### Response Format

```json
{
  "decision": "BLOCK",
  "scores": {
    "heuristic": 0.85,
    "ml_confidence": 0.92,
    "semantic": 0.75
  },
  "reason": "High heuristic score - possible prompt injection",
  "latency_ms": 15,
  "request_id": "uuid"
}
```

Decisions: ALLOW (safe), WARN (review), BLOCK (reject)

---

## Account & Funding

Both proxy and API require a funded account:

1. **Create account**: https://getstronghold.xyz/dashboard or `stronghold init`
2. **Deposit USDC**: Via dashboard (Stripe) or direct transfer on Base or Solana
3. **Pay-per-request**: $0.001 per scan

Payment networks: Base (EVM) and Solana. Both use USDC.

Check balance: `stronghold account balance`
Add funds: `stronghold account deposit`

---

## TOTP and Wallet Uploads (Important)

Stronghold supports optional server-side wallet storage for easier setup on new devices.
If you choose to upload your wallet to the server, **TOTP is required**.

### Wallet Upload Rules

- **TOTP required** when uploading or replacing a wallet on the server.
- **Account number alone is read-only**. Sensitive actions require TOTP when server wallet storage is enabled.
- Wallets can also stay **local-only** (no TOTP required, no server storage).

### TOTP Recovery

- During TOTP setup, Stronghold provides **recovery codes**.
- **Recovery codes are shown once**. Save them securely.
- If the authenticator is lost, a recovery code is required to trust a new device.

### Device Trust

- After a successful TOTP verification, the device is trusted.
- Trust duration is per device: **30 days**, **90 days**, or **indefinite** (default).
- Trusted devices can be revoked from the dashboard or CLI.

---

## Links

- Documentation: https://github.com/yv-was-taken/stronghold
- Human Docs: https://docs.stronghold.xyz
- API Spec: https://api.getstronghold.xyz/docs
- Dashboard: https://getstronghold.xyz/dashboard
- Full Reference: https://getstronghold.xyz/llms-full.txt
