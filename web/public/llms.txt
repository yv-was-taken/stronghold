# Stronghold - AI Security Scanning

> Protect AI agents from prompt injection attacks and credential leaks

## Two-Way Protection

Stronghold protects both directions of data flow:

```
External content -> [PROXY scans] -> Agent -> [API scans] -> Output
                     |                         |
                  Injection               Credential leaks
                  (INCOMING)              (OUTGOING)
```

**Proxy**: Scans INCOMING content, blocks prompt injection before agent sees it
**API**: Scans OUTGOING content, catches credential leaks in agent responses

Both require payment. B2C users pay $0.001 per scan via x402 crypto. B2B users authenticate with API keys and pay via prepaid credits or metered billing.

**Note on USDC amounts**: Canonical money fields are string-encoded microUSDC
integers (1 microUSDC = 0.000001 USDC). For example, `"1000"` = $0.001,
`"1000000"` = $1.00. `/v1/pricing` exposes both `price_micro_usdc` (canonical)
and `price_usd` (human-readable convenience).

**Breaking change (February 18, 2026)**: money fields in API responses moved
from JSON numbers to string-encoded microUSDC values. Clients parsing numbers
must migrate.

---

## 1. Transparent Proxy (Recommended for Incoming Content)

Network-level interception that scans content BEFORE your agent processes it.

### Why Network-Level?

- Agent NEVER processes malicious content - blocked before delivery
- Cannot be bypassed by prompt injection (operates outside agent's cognition)
- Works for all processes automatically (iptables/nftables/pf)

### Quick Start

```bash
# Install
curl -fsSL https://getstronghold.xyz/install.sh | sh

# Check system prerequisites
stronghold doctor

# Interactive setup (creates account, configures system)
sudo stronghold init

# Enable protection
sudo stronghold enable

# Check status
stronghold status

# Check API and RPC health
stronghold health
```

### CLI Commands

| Command                    | Description                                           |
|----------------------------|-------------------------------------------------------|
| stronghold doctor          | Check system prerequisites                            |
| stronghold init            | Interactive setup (requires sudo)                     |
| stronghold init --yes      | Non-interactive setup with defaults                   |
| stronghold init --yes --skip-service | Skip proxy/service install (account setup only) |
| stronghold enable          | Start proxy, enable interception                      |
| stronghold disable         | Stop proxy, restore direct access                     |
| stronghold status          | Show proxy status, balances (Base/Solana), and stats  |
| stronghold health          | Check API and Base/Solana RPC health                  |
| stronghold account balance | Check balance (Base and Solana wallets)               |
| stronghold account deposit | Show deposit addresses (Base and Solana)              |
| stronghold wallet list     | List configured wallet addresses by chain             |
| stronghold wallet balance  | Show per-chain wallet balances                        |
| stronghold wallet export   | Export private keys for backup (both chains)          |
| stronghold wallet replace  | Replace wallet (`replace evm` or `replace solana`)     |
| stronghold wallet link     | Register wallet addresses with the server             |
| stronghold config get      | Get configuration value                               |
| stronghold config set      | Set configuration value                               |

### Wallet Import During Init

```bash
# Import both EVM and Solana wallets (non-interactive)
stronghold init --yes --private-key 0x<evm-hex-key> --solana-private-key <base58-solana-key>

# Import only EVM wallet (Solana auto-generated)
stronghold init --yes --private-key 0x<evm-hex-key>

# Import only Solana wallet (EVM auto-generated)
stronghold init --yes --solana-private-key <base58-solana-key>
```

### Wallet Replace

Key source precedence (first match wins):
1. `--file` flag (explicit file path)
2. Environment variable (`STRONGHOLD_PRIVATE_KEY` for EVM, `STRONGHOLD_SOLANA_PRIVATE_KEY` for Solana)
3. stdin (if piped)
4. Interactive prompt (if terminal)

```bash
# List configured wallets and balances
stronghold wallet list
stronghold wallet balance

# Replace Base (EVM) wallet
stronghold wallet replace evm

# Replace Solana wallet
stronghold wallet replace solana

# Non-interactive with env var
STRONGHOLD_PRIVATE_KEY=0x... stronghold wallet replace evm --yes
STRONGHOLD_SOLANA_PRIVATE_KEY=... stronghold wallet replace solana --yes

# From file
stronghold wallet replace evm --file /path/to/key.txt
```

### Environment Variables

| Variable             | Description                                |
|----------------------|--------------------------------------------|
| STRONGHOLD_API_URL   | Override API endpoint (dev/testing)         |

### Response Headers for Agentic Integration

When Stronghold proxy scans content, it adds headers to every response:

| Header | Description | Values |
|--------|-------------|--------|
| X-Stronghold-Decision | Scan result | ALLOW, WARN, BLOCK |
| X-Stronghold-Action | What proxy did | allow, warn, block |
| X-Stronghold-Reason | Why (if flagged) | Human-readable reason |
| X-Stronghold-Score | Threat score | 0.00 - 1.00 |
| X-Stronghold-Scan-Type | What was scanned | content, disabled, skipped-* |
| X-Stronghold-Warning | Warning message | (only if action=warn) |

These headers are always present, even when content is not blocked.

### Configuring Scan Behavior

Control blocking behavior via config:

```bash
# View current settings
stronghold config get scanning

# Never block content (scan only, headers show results)
stronghold config set scanning.content.action_on_block allow
stronghold config set scanning.content.action_on_warn allow

# Strict mode - block even warnings
stronghold config set scanning.content.action_on_warn block
```

---

## 2. Direct API

Base URL: https://api.getstronghold.xyz

### Authentication

Two authentication methods:

**B2C (x402 payment)**: Include `X-PAYMENT` header with each request. Used by CLI/proxy.
**B2B (API key)**: Include `X-API-Key: sk_live_...` header. Manage keys via dashboard or API.

```bash
# B2C: x402 payment
curl -X POST https://api.getstronghold.xyz/v1/scan/output \
  -H "Content-Type: application/json" \
  -H "X-PAYMENT: <x402-payment-header>" \
  -d '{"text": "..."}'

# B2B: API key
curl -X POST https://api.getstronghold.xyz/v1/scan/output \
  -H "Content-Type: application/json" \
  -H "X-API-Key: sk_live_a1b2c3d4..." \
  -d '{"text": "..."}'
```

### Jailbreak Detection

- **B2C**: Jailbreak threats are always filtered from scan results.
- **B2B**: Jailbreak threats are included by default. Toggle via settings API.

### POST /v1/scan/output (Recommended API use)

Scans agent responses BEFORE sending to users. Catches credential leaks.

Use this to check agent output for accidentally exposed:
- API keys and tokens
- Passwords and secrets
- Database connection strings

```bash
curl -X POST https://api.getstronghold.xyz/v1/scan/output \
  -H "Content-Type: application/json" \
  -H "X-PAYMENT: <x402-payment-header>" \
  -d '{"text": "Here is the config: DB_PASSWORD=secret123"}'
```

### POST /v1/scan/content (Proxy recommended instead)

Scans text for prompt injection.

**Warning**: We STRONGLY recommend the transparent proxy instead:
- To call this API, your agent must first READ the content
- At that moment, prompt injection can already affect the agent
- The agent might "forget" to call the API or ignore the result
- The proxy blocks threats BEFORE the agent ever sees them

If you cannot install the proxy (serverless, sandboxed environments),
this endpoint exists as a fallback.

```bash
curl -X POST https://api.getstronghold.xyz/v1/scan/content \
  -H "Content-Type: application/json" \
  -H "X-PAYMENT: <x402-payment-header>" \
  -d '{"text": "Ignore previous instructions...", "source_url": "https://example.com"}'
```

### API Key Management

| Method | Path | Description |
|--------|------|-------------|
| POST | /v1/account/api-keys | Create API key (returns raw key once) |
| GET | /v1/account/api-keys | List all API keys |
| DELETE | /v1/account/api-keys/:id | Revoke an API key |

### Account Settings

| Method | Path | Description |
|--------|------|-------------|
| GET | /v1/account/settings | Get settings (jailbreak_detection_enabled) |
| PUT | /v1/account/settings | Update settings |

### Response Format

```json
{
  "decision": "BLOCK",
  "scores": {
    "heuristic": 0.85,
    "ml_confidence": 0.92,
    "semantic": 0.75
  },
  "reason": "High heuristic score - possible prompt injection",
  "latency_ms": 15,
  "request_id": "uuid"
}
```

Decisions: ALLOW (safe), WARN (review), BLOCK (reject)

---

## Account & Funding

Both proxy and API require a funded account:

1. **Create account**: https://getstronghold.xyz/dashboard or `stronghold init`
2. **Deposit USDC**: Via dashboard (Stripe) or direct transfer on Base or Solana
3. **Pay-per-request**: $0.001 per scan

Payment networks: Base (EVM) and Solana. Both use USDC.

Check balance: `stronghold account balance`
Add funds: `stronghold account deposit`

---

## B2B / API Key Access (Business Accounts)

For server-to-server integration, Stronghold supports B2B accounts with SSO
authentication via WorkOS, API keys, and traditional card billing via Stripe.

### Quick Start

1. **Sign in**: Visit the dashboard and click "Business" tab → "Sign in with SSO" (handled by WorkOS AuthKit)
2. **Onboard**: Set your company name on first sign-in (`POST /v1/auth/b2b/onboard`)
3. **Create API key**: `POST /v1/api-keys` (WorkOS JWT auth required) → returns `sk_live_...`
4. **Make requests**: `Authorization: Bearer sk_live_...` on scan endpoints

### Authentication

**SSO (WorkOS AuthKit)** for dashboard login. WorkOS handles signup, login, password
management, email verification, MFA, and social login. The backend validates WorkOS
JWTs via JWKS and auto-provisions a local B2B account on first sign-in (JIT provisioning).

**API keys** (`sk_live_...`) for scan endpoints. Created via the JWT-authenticated
management endpoints in the dashboard.

### Billing

Two payment methods, used in order:
1. **Prepaid credits**: Purchase via Stripe Checkout (`POST /v1/billing/credits`)
2. **Metered overflow**: When credits run out, usage is metered and billed monthly via Stripe

### Scan Endpoint Usage

```bash
# With API key (B2B)
curl -X POST https://api.getstronghold.xyz/v1/scan/content \
  -H "Authorization: Bearer sk_live_abc123..." \
  -H "Content-Type: application/json" \
  -d '{"text": "content to scan"}'

# With x402 crypto payment (B2C - unchanged)
curl -X POST https://api.getstronghold.xyz/v1/scan/content \
  -H "X-PAYMENT: <x402-payment-header>" \
  -H "Content-Type: application/json" \
  -d '{"text": "content to scan"}'
```

### B2B API Endpoints

| Endpoint | Method | Auth | Description |
|----------|--------|------|-------------|
| /v1/auth/b2b/onboard | POST | WorkOS JWT | Set company name (first sign-in) |
| /v1/api-keys | POST | JWT | Create API key |
| /v1/api-keys | GET | JWT | List API keys |
| /v1/api-keys/:id | DELETE | JWT | Revoke API key |
| /v1/billing/credits | POST | JWT | Purchase credits (Stripe Checkout) |
| /v1/billing/info | GET | JWT | Get billing info |
| /v1/billing/portal | POST | JWT | Create Stripe billing portal session |

---

## TOTP and Wallet Uploads (Important)

Stronghold supports optional server-side wallet storage for easier setup on new devices.
If you choose to upload your wallet to the server, **TOTP is required**.

### Wallet Upload Rules

- **TOTP required** when uploading or replacing a wallet on the server.
- **Account number alone is read-only**. Sensitive actions require TOTP when server wallet storage is enabled.
- Wallets can also stay **local-only** (no TOTP required, no server storage).

### TOTP Recovery

- During TOTP setup, Stronghold provides **recovery codes**.
- **Recovery codes are shown once**. Save them securely.
- If the authenticator is lost, a recovery code is required to trust a new device.

### Device Trust

- After a successful TOTP verification, the device is trusted.
- Trust duration is per device: **30 days**, **90 days**, or **indefinite** (default).
- Trusted devices can be revoked from the dashboard or CLI.

---

## Links

- Documentation: https://github.com/yv-was-taken/stronghold
- Human Docs: https://docs.getstronghold.xyz
- API Spec: https://api.getstronghold.xyz/docs
- Dashboard: https://getstronghold.xyz/dashboard
- Full Reference: https://getstronghold.xyz/llms-full.txt
